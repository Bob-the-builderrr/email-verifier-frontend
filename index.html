<script>
  // Replace this line with your Render backend URL
  const BACKEND_URL = "https://email-verifier-backend.onrender.com/verify-emails";

  document.getElementById('emailForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    let emails = [];
    const emailInput = document.getElementById('emails').value;
    const fileInput = document.getElementById('csvFile').files[0];

    if (emailInput) {
      emails = emailInput.split('\n').map(email => email.trim()).filter(Boolean);
    } else if (fileInput) {
      const reader = new FileReader();
      reader.onload = async function (e) {
        const fileContent = e.target.result;
        emails = fileContent.split('\n').map(row => row.trim()).filter(row => row.includes('@'));
        await verifyEmails(emails);
      };
      reader.readAsText(fileInput);
      return;
    }

    if (emails.length > 0) {
      await verifyEmails(emails);
    }
  });

  async function verifyEmails(emails) {
    document.getElementById('result').innerHTML = 'Verifying... Please wait.';
    const response = await fetch(BACKEND_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ emails })
    });

    const results = await response.json();
    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = '';
    results.forEach(({ email, isValid, errorMessage }) => {
      resultDiv.innerHTML += `
        <div>
          <strong>${email}</strong>: ${isValid ? '✅ Valid' : '❌ Invalid'}<br>
          <em>Reason:</em> ${errorMessage}
          <hr>
        </div>
      `;
    });
  }
</script>
